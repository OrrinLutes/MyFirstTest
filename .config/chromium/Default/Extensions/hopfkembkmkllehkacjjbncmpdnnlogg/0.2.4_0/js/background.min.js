"use strict";function setFileName(e){var o=/(\d{4}-\d{2}-\d{2})T(\d{2}\:\d{2}\:\d{2})/,t=e.start.match(o),n=e.end.match(o),i=t[2].replace(/\:/g,"-"),r=n[2].replace(/\:/g,"-");return"Rec-"+t[1]+"-From-"+i+"-To-"+r+".wav"}function Timer(e){var o,t,n,i=this;i.start=function(){n=0,t=(new Date).toISOString(),o=window.setInterval(function(){n++,e(n.toString())},1e3)},i.stop=function(){return n=0,clearInterval(o),{start:t,end:(new Date).toISOString()}}}function gotBuffers(e){audioRecorder.exportMonoWAV(doneEncoding)}function doneEncoding(e){var o=(window.URL||window.webkitURL).createObjectURL(e),t=document.getElementById("save");t.href=o,t.download=filename||"output.wav",t.click()}function convertToMono(e){var o=audioContext.createChannelSplitter(2),t=audioContext.createChannelMerger(2);return e.connect(o),o.connect(t,0,0),o.connect(t,0,1),t}function toggleMono(){audioInput!=realAudioInput?(audioInput.disconnect(),realAudioInput.disconnect(),audioInput=realAudioInput):(realAudioInput.disconnect(),audioInput=convertToMono(realAudioInput)),audioInput.connect(inputPoint)}function gotStream(e){inputPoint=audioContext.createGain(),realAudioInput=audioContext.createMediaStreamSource(e),audioInput=realAudioInput,audioInput.connect(inputPoint),analyserNode=audioContext.createAnalyser(),analyserNode.fftSize=2048,inputPoint.connect(analyserNode),audioRecorder=new Recorder(inputPoint),zeroGain=audioContext.createGain(),zeroGain.gain.value=0,inputPoint.connect(zeroGain),zeroGain.connect(audioContext.destination)}function initAudio(){navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia),navigator.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}},gotStream,function(e){console.log(e),chrome.browserAction.setIcon({path:"../images/icon-16-grey.png"}),chrome.browserAction.setTitle({title:"Most likely you have no mic on your machine\nPlease set it up and reload your Chrome"}),chrome.browserAction.disable()})}window.AudioContext=window.AudioContext||window.webkitAudioContext;var audioContext=new AudioContext,audioInput,realAudioInput,inputPoint,audioRecorder,analyserNode,zeroGain,filename,timer=new Timer(function(e){chrome.browserAction.setBadgeText({text:e})});window.addEventListener("load",initAudio),chrome.browserAction.setBadgeBackgroundColor({color:"#000"}),chrome.runtime.onInstalled.addListener(function(e){chrome.tabs.create({url:chrome.extension.getURL("welcome.html"),active:!0})}),chrome.browserAction.onClicked.addListener(function(){var e,o,t;chrome.browserAction.getTitle({},function(n){if("Click to start recording"===n)o="Click to stop recording",e="../images/icon-16-red.png",timer.start(),audioRecorder.clear(),audioRecorder.record();else{if(o="Click to start recording",e="../images/icon-16.png",t=timer.stop(),filename=setFileName(t),chrome.browserAction.setBadgeText({text:""}),!audioRecorder)return;audioRecorder.stop(),audioRecorder.getBuffers(gotBuffers)}chrome.browserAction.setIcon({path:e}),chrome.browserAction.setTitle({title:o})})});
!function(t){var e="js/worker.min.js",o=function(t,o){var n=o||{},a=n.bufferLen||4096;this.context=t.context,this.node=this.context.createScriptProcessor?this.context.createScriptProcessor(a,2,2):this.context.createJavaScriptNode(a,2,2);var s=new Worker(n.workerPath||e);s.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var r,c=!1;this.node.onaudioprocess=function(t){c&&s.postMessage({command:"record",buffer:[t.inputBuffer.getChannelData(0),t.inputBuffer.getChannelData(1)]})},this.configure=function(t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e])},this.record=function(){c=!0},this.stop=function(){c=!1},this.clear=function(){s.postMessage({command:"clear"})},this.getBuffers=function(t){r=t||n.callback,s.postMessage({command:"getBuffers"})},this.exportWAV=function(t,e){if(r=t||n.callback,e=e||n.type||"audio/wav",!r)throw new Error("Callback not set");s.postMessage({command:"exportWAV",type:e})},this.exportMonoWAV=function(t,e){if(r=t||n.callback,e=e||n.type||"audio/wav",!r)throw new Error("Callback not set");s.postMessage({command:"exportMonoWAV",type:e})},s.onmessage=function(t){var e=t.data;r(e)},t.connect(this.node),this.node.connect(this.context.destination)};t.Recorder=o}(window);