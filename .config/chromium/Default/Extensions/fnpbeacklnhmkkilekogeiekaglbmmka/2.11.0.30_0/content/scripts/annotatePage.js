(function(d){(d.NSSS=d.NSSS||{}).annotatePage=function(c,e){var b={};b.isTop=window===window.top;var d=e.utils.isNil,m=e.utils.isntNil,t=c.nfmEvents,n=c.constants,l=c.uiConstants,g=l.MESSAGES,h=e.extensionAdapter,p=e.utils.createNewGuid(),q=e.performanceReporterFactoryProxy,r="Annotation Time: "+Date.now();b._popupClosed=!0;b.COLLECT_URL_TIMEOUT=500;b._canAllowAnnotations=function(){return l.EXTENSION_TYPE===l.SAFEWEB_EXTENSION&&"Chrome"===e.globals.BROWSER&&e.utils.getOSType()!==e.constants.os.WINDOWS?
0<=window.location.host.toLowerCase().search("ask")||0<=document.referrer.search("nortonsafe.search.ask.com")?!0:!1:!0};b.collectURLs=function(){q.reportStart(n.performanceReporter.NSSS,r);if(!1!==b._canAllowAnnotations()&&!d(Shasta)){var a=Shasta.collectURLs();h.sendMessage({name:g.COLLECT_URL_RESPONSE,message:{eventID:t.SEARCH_URLS,search_urls:a,frameId:p}})}};b.showAnnotationPopup=function(a){if(b.isTop){var k=document.getElementById("annotationPopup");k.style.display="block";var f=a.top,d=a.left,
e=d+406,c=f+238;innerHeight<c&&(c-=innerHeight,f-=c);innerWidth<e&&(c=e-innerWidth,d-=c);0>f&&(f=2);k.style.top=f+"px";k.style.left=d+"px";k.style.border="none";k=document.getElementById("annotationPopup").contentWindow;f=a.annotationURLObject.annotationData;f.index=a.index;k.postMessage({name:"preparePopup",message:f},"*")}};b.closeAnnotationPopup=function(){if(b.isTop){var a=document.getElementById("annotationPopup");m(a)&&(a.style.display="none")}};b.annotateURLs=function(a){var c=a.annotationResults;
d(Shasta)||m(a.frameId)&&a.frameId!==p||(Shasta.setResults(c),q.reportEnd(n.performanceReporter.NSSS,r),document.addEventListener("showAnnotationPopup",function(a){h.sendMessage({name:g.SHOW_ANNOTATION_POPUP,message:a.detail});b._popupClosed=!1}),document.addEventListener("closeAnnotationPopup",function(a){!1===b._popupClosed&&(h.sendMessage({name:g.CLOSE_ANNOATION_POPUP}),b._popupClosed=!0)}),b.isTop&&(a=document.getElementById("annotationPopup"),d(a)&&(a=document.createElement("iframe"),a.id="annotationPopup",
a.style.cssText="position:fixed;top:0;left:0;display:none;width:408px;height:240px;z-index:1000;",a.src=h.getExtensionURL("content/ui/SiteRatingPane.html"),document.body.appendChild(a))))};b.canCloseAnnotationPopup=function(){b.isTop&&document.getElementById("annotationPopup").contentWindow.postMessage({name:"canCloseAnnotation"},"*")};b.handleCustomMessages=function(a){switch(a.name){case "annotate-urls":b.annotateURLs(a);break;case g.SHOW_ANNOTATION_POPUP:b.showAnnotationPopup(a.data);break;case g.CLOSE_ANNOATION_POPUP:b.canCloseAnnotationPopup()}};
b.handleOpenFullReport=function(a){h.sendMessage({name:g.OPEN_FULLREPORT,message:{index:a.detail}})};b.receiveMessage=function(a){switch(a.data.name){case "closeAnnotationPopup":b.closeAnnotationPopup();break;case "openFullReportFromPanel":h.sendMessage({name:g.OPEN_FULLREPORT,message:{index:a.data.message.index}})}};b.handleBasicMessage=function(a,c,d){b.handleCustomMessages(a)};b.handleWindowLoad=function(){document.addEventListener("CollectUrlEvent",function(){setTimeout(c.annotatePage.collectURLs,
c.annotatePage.COLLECT_URL_TIMEOUT)});setTimeout(c.annotatePage.collectURLs,c.annotatePage.COLLECT_URL_TIMEOUT)};return b}(d.NSSS,d.SymBfw)})(executionContext);SymBfw.extensionAdapter.addMessageListener(NSSS.annotatePage.handleBasicMessage);window.addEventListener("load",function(){NSSS.annotatePage.handleWindowLoad()});document.addEventListener("openFullReport",NSSS.annotatePage.handleOpenFullReport);window.addEventListener("message",NSSS.annotatePage.receiveMessage,!1);
